# ADR-002: Server-Side Entity ID Generation  

**Status**: Accepted  
**Date**: 2025-07-20

## Context

Entity creation (users, memories, entries, contexts) requires unique identifiers. While some systems use client-generated IDs, our architecture generates canonical entity IDs on the server to ensure uniqueness and maintain authoritative control over the data model.

## Decision

1. All entity IDs (`userId`, `vaultId`, `memoryId`, `entryId`, `contextId`) are generated by the server using UUID v4
2. Server generates IDs during `Create*` operations and returns them in the response
3. Client-side operations use server-returned IDs for subsequent operations
4. UUID v4 from `github.com/google/uuid` is the reference implementation

## Consequences

### Positive Consequences
- Server maintains authoritative control over entity identity
- Eliminates possibility of client-side ID conflicts
- Consistent ID format across all entities
- Simplifies client implementation (no ID generation logic needed)

### Negative Consequences
- Requires round-trip to server for entity creation
- Client must wait for server response to obtain entity ID
- Cannot perform optimistic operations with pre-known IDs

## Implementation Notes

### Server ID Generation
- Server generates UUID v4 for all new entities
- IDs generated using cryptographically secure random number generator  
- Primary key constraints ensure uniqueness at database level

### Client Behavior
- Client sends create requests without pre-generating IDs
- Server responds with newly created entity including generated ID
- Client caches returned IDs for subsequent operations

### API Design
- All `Create*` endpoints return the generated entity with ID
- Client SDKs expose methods that return the full created entity
- Error handling for rare UUID collision cases (statistically negligible)
